# DeepChat Skills ç³»ç»Ÿè®¾è®¡æ–‡æ¡£

## 1. æ¦‚è¿°

### 1.1 æ ¸å¿ƒç†å¿µ

Skills æ˜¯ä¸€ä¸ª**æ–‡ä»¶ä½“ç³»**ï¼Œä¸º AI Agent æä¾›å¯æ¿€æ´»çš„ä¸“ä¸šçŸ¥è¯†å’Œè¡Œä¸ºæŒ‡å¯¼ã€‚

**å…³é”®ç‰¹å¾**ï¼š
- **æ–‡ä»¶é©±åŠ¨**ï¼šSkills ä»¥æ–‡ä»¶å½¢å¼å­˜åœ¨äºæ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œç”¨æˆ·åœ¨è®¾ç½®ä¸­ç®¡ç†
- **æ¨¡å‹è‡ªä¸»**ï¼šç”± LLM é€šè¿‡å·¥å…·å†³å®šä½•æ—¶æ¿€æ´»/åœç”¨ Skill
- **æ¸è¿›åŠ è½½**ï¼šMetadata å§‹ç»ˆåœ¨ Contextï¼Œå®Œæ•´å†…å®¹ä»…æ¿€æ´»ååŠ è½½
- **å·¥å…·å¤ç”¨**ï¼šSkill å†…çš„ scripts/references é€šè¿‡ç°æœ‰å·¥å…·ï¼ˆRead/Bashï¼‰è®¿é—®
- **çƒ­åŠ è½½**ï¼šç›‘æ§ Skill æ–‡ä»¶å˜åŒ–ï¼Œè‡ªåŠ¨æ›´æ–° Metadata

### 1.2 å·¥ä½œæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. å¯åŠ¨æ—¶ï¼šæ‰«ææ–‡ä»¶ç³»ç»Ÿï¼Œæå–æ‰€æœ‰ Skill çš„ Metadata         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. æ¯è½®å¯¹è¯ï¼šMetadata åˆ—è¡¨å§‹ç»ˆå­˜åœ¨äº Context                â”‚
â”‚    "Available skills: code-review, refactor, ..."          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. æ¨¡å‹å†³ç­–ï¼šæ ¹æ®ç”¨æˆ·æ„å›¾ï¼Œè°ƒç”¨ skill_control å·¥å…·          â”‚
â”‚    skill_control({ action: "activate", skill_name: "..." })â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. ä¸‹ä¸€è½® Loopï¼šåŠ è½½å·²æ¿€æ´» Skill çš„å®Œæ•´ SKILL.md å†…å®¹       â”‚
â”‚    æ³¨å…¥åˆ°ç³»ç»Ÿæç¤ºä¸­                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. æ¨¡å‹æ‰§è¡Œï¼šæ ¹æ® SKILL.md æŒ‡ä»¤ï¼Œç”¨ç°æœ‰å·¥å…·è®¿é—®èµ„æº         â”‚
â”‚    - Read å·¥å…·è¯»å– references/                              â”‚
â”‚    - Bash å·¥å…·æ‰§è¡Œ scripts/                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.3 è®¾è®¡ç›®æ ‡

| ç›®æ ‡ | æè¿° | ä¼˜å…ˆçº§ |
|------|------|--------|
| **æ–‡ä»¶ä½“ç³»** | Skills ä»¥æ–‡ä»¶å¤¹å½¢å¼å­˜åœ¨ï¼Œç”¨æˆ·åœ¨è®¾ç½®ä¸­ç®¡ç† | P0 |
| **æ¨¡å‹è‡ªä¸»æ¿€æ´»** | LLM é€šè¿‡å·¥å…·æ§åˆ¶ Skill æ¿€æ´»çŠ¶æ€ | P0 |
| **æ¸è¿›åŠ è½½** | Metadata å¸¸é©»ï¼Œå®Œæ•´å†…å®¹æŒ‰éœ€åŠ è½½ | P0 |
| **çƒ­åŠ è½½** | ç›‘æ§æ–‡ä»¶å˜åŒ–ï¼Œè‡ªåŠ¨æ›´æ–° Metadata | P0 |
| **å·¥å…·æ‰©å±•** | Skill å¯å£°æ˜é¢å¤–éœ€è¦çš„å·¥å…· | P1 |

### 1.4 éç›®æ ‡

- Skill å¸‚åœºå’Œåœ¨çº¿åˆ†å‘
- Skill ç‰ˆæœ¬ç®¡ç†å’Œä¾èµ–è§£æ
- å¤š Skill ç¼–æ’å’Œå·¥ä½œæµ
- ä¸ Custom Prompts åˆå¹¶
- é¡¹ç›®çº§/ç”¨æˆ·çº§åˆ†å±‚ï¼ˆå½“å‰ä»…ç”¨æˆ·çº§ï¼‰

---

## 2. æ–‡ä»¶ä½“ç³»

### 2.1 ç›®å½•ç»“æ„

```
~/.deepchat/skills/                  # Skills ç›®å½•
â”œâ”€â”€ code-review/                     # Skill æ–‡ä»¶å¤¹
â”‚   â”œâ”€â”€ SKILL.md                     # å¿…éœ€ï¼šå…ƒæ•°æ® + å®Œæ•´æŒ‡ä»¤
â”‚   â”œâ”€â”€ references/                  # å¯é€‰ï¼šå‚è€ƒæ–‡æ¡£
â”‚   â”‚   â”œâ”€â”€ style-guide.md
â”‚   â”‚   â””â”€â”€ checklist.md
â”‚   â””â”€â”€ scripts/                     # å¯é€‰ï¼šè¾…åŠ©è„šæœ¬
â”‚       â””â”€â”€ lint.sh
â”œâ”€â”€ refactor/
â”‚   â””â”€â”€ SKILL.md
â””â”€â”€ my-skill/
    â””â”€â”€ SKILL.md
```

**è¯´æ˜**ï¼š
- å†…ç½® Skills é¦–æ¬¡å¯åŠ¨æ—¶è‡ªåŠ¨å®‰è£…åˆ°åŒä¸€ç›®å½•
- ç”¨æˆ·åœ¨è®¾ç½®ç•Œé¢ä¸­ç®¡ç† Skillsï¼ˆå¯ç”¨/ç¦ç”¨/ç¼–è¾‘ï¼‰
- ç”¨æˆ·å¯åˆ é™¤æˆ–ä¿®æ”¹å†…ç½® Skills

### 2.2 Skill å®‰è£…

æ”¯æŒä¸‰ç§å®‰è£…æ–¹å¼ï¼š

| æ–¹å¼ | è¯´æ˜ | ä½¿ç”¨åœºæ™¯ |
|------|------|----------|
| æœ¬åœ°æ–‡ä»¶å¤¹ | é€‰æ‹©åŒ…å« SKILL.md çš„æ–‡ä»¶å¤¹ | ä»å…¶ä»–å®¢æˆ·ç«¯æ‹·è´ï¼ˆå¦‚ ~/.claude/skills/ï¼‰ |
| æœ¬åœ° zip | é€‰æ‹© zip æ–‡ä»¶ | ä¸‹è½½çš„ Skill åŒ… |
| URL | è¾“å…¥ zip ä¸‹è½½åœ°å€ | åœ¨çº¿å®‰è£… |

**æ–‡ä»¶å¤¹/zip ç»“æ„è¦æ±‚**ï¼š

```
skill-name/                  # Skill æ–‡ä»¶å¤¹
â”œâ”€â”€ SKILL.md                 # å¿…éœ€
â”œâ”€â”€ references/              # å¯é€‰
â””â”€â”€ scripts/                 # å¯é€‰
```

**å®‰è£…æµç¨‹**ï¼š

```
ç”¨æˆ·é€‰æ‹©æ–‡ä»¶å¤¹ / zip æ–‡ä»¶ / è¾“å…¥ URL
    â”‚
    â–¼
è¯»å–æ–‡ä»¶å¤¹ / è§£å‹ zip / ä¸‹è½½å¹¶è§£å‹
    â”‚
    â–¼
éªŒè¯ç»“æ„ï¼ˆSKILL.md å¿…é¡»å­˜åœ¨ï¼‰
    â”‚
    â–¼
è§£æ SKILL.md frontmatterï¼Œè·å– name
    â”‚
    â–¼
éªŒè¯ name ä¸ç›®å½•åä¸€è‡´ï¼ˆä¸ä¸€è‡´åˆ™è‡ªåŠ¨é‡å‘½åç›®å½•ä¸º nameï¼‰
    â”‚
    â–¼
æ£€æŸ¥åŒå Skill æ˜¯å¦å­˜åœ¨
    â”‚
    â”œâ”€â”€ å­˜åœ¨ â†’ æç¤ºç”¨æˆ·ç¡®è®¤è¦†ç›–
    â”‚
    â–¼
æ‹·è´åˆ° ~/.deepchat/skills/{name}/
    â”‚
    â–¼
è§¦å‘çƒ­åŠ è½½ï¼Œæ›´æ–° Metadata
```

**å†²çªå¤„ç†**ï¼š
- åŒå Skill å·²å­˜åœ¨æ—¶ï¼Œæç¤ºç”¨æˆ·é€‰æ‹©ï¼šè¦†ç›– / å–æ¶ˆ
- è¦†ç›–æ—¶å…ˆå¤‡ä»½åŸ Skill æ–‡ä»¶å¤¹

### 2.3 SKILL.md æ ¼å¼

```markdown
---
name: code-review
description: æŒ‰ç…§å›¢é˜Ÿè§„èŒƒè¿›è¡Œä»£ç å®¡æŸ¥ï¼Œæ£€æŸ¥ä»£ç è´¨é‡ã€å®‰å…¨æ€§å’Œå¯ç»´æŠ¤æ€§
allowedTools:                        # å¯é€‰ï¼šé¢å¤–éœ€è¦çš„å·¥å…·ï¼ˆä¸ç”¨æˆ·å·²å¯ç”¨å·¥å…·å–å¹¶é›†ï¼‰
  - Read
  - Grep
  - Glob
  - Bash(git:*)
---

# Code Review Skill

å½“å‰ Skill æ ¹ç›®å½•: ${SKILL_ROOT}

## ä½ çš„è§’è‰²

ä½ æ˜¯ä¸€ä¸ªä»£ç å®¡æŸ¥ä¸“å®¶ï¼Œè´Ÿè´£æŒ‰ç…§å›¢é˜Ÿè§„èŒƒå®¡æŸ¥ä»£ç å˜æ›´ã€‚

## å®¡æŸ¥æµç¨‹

1. é¦–å…ˆä½¿ç”¨ `git diff` æŸ¥çœ‹å˜æ›´èŒƒå›´
2. é˜…è¯» ${SKILL_ROOT}/references/checklist.md äº†è§£æ£€æŸ¥é¡¹
3. é€ä¸ªæ£€æŸ¥ä»£ç å˜æ›´
4. è¾“å‡ºç»“æ„åŒ–çš„å®¡æŸ¥æŠ¥å‘Š

## èµ„æºä½ç½®

- æ£€æŸ¥æ¸…å•: ${SKILL_ROOT}/references/checklist.md
- ä»£ç è§„èŒƒ: ${SKILL_ROOT}/references/style-guide.md
- Lint è„šæœ¬: ${SKILL_ROOT}/scripts/lint.sh

## è¾“å‡ºæ ¼å¼

å¯¹äºæ¯ä¸ªå‘ç°ï¼Œä½¿ç”¨ä»¥ä¸‹æ ¼å¼ï¼š
- **ä½ç½®**: æ–‡ä»¶:è¡Œå·
- **çº§åˆ«**: ğŸ”´ ä¸¥é‡ | ğŸŸ¡ å»ºè®® | ğŸŸ¢ ä¼˜åŒ–
- **æè¿°**: é—®é¢˜æè¿°
- **å»ºè®®**: ä¿®å¤å»ºè®®
```

### 2.4 Frontmatter å­—æ®µ

| å­—æ®µ | ç±»å‹ | å¿…éœ€ | è¯´æ˜ |
|------|------|------|------|
| `name` | string | æ˜¯ | Skill å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œ**å¿…é¡»ä¸ç›®å½•åä¸€è‡´** |
| `description` | string | æ˜¯ | ç®€çŸ­æè¿°ï¼Œç”¨äºæ¨¡å‹ç†è§£ä½•æ—¶ä½¿ç”¨ |
| `allowedTools` | string[] | å¦ | é¢å¤–éœ€è¦çš„å·¥å…·ï¼Œä¸ç”¨æˆ·å·²å¯ç”¨å·¥å…·å–å¹¶é›† |

### 2.5 Name ä¸ç›®å½•åä¸€è‡´æ€§

`name` æ˜¯ Skill çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œ**å¿…é¡»ä¸ç›®å½•åä¿æŒä¸€è‡´**ã€‚

**å®‰è£…æ—¶éªŒè¯**ï¼š
```
è§£æ SKILL.md frontmatter è·å– name
    â”‚
    â–¼
æ¯”è¾ƒ name ä¸æºç›®å½•å
    â”‚
    â”œâ”€â”€ ä¸€è‡´ â†’ ç›´æ¥æ‹·è´åˆ° ~/.deepchat/skills/{name}/
    â”‚
    â””â”€â”€ ä¸ä¸€è‡´ â†’ è‡ªåŠ¨é‡å‘½åç›®å½•ä¸º nameï¼Œæ‹·è´åˆ° ~/.deepchat/skills/{name}/
```

**æŒä¹…åŒ–**ï¼š
- `activeSkills` æŒä¹…åŒ– `name`ï¼ˆè€Œéç›®å½•è·¯å¾„ï¼‰
- æ¢å¤ä¼šè¯æ—¶é€šè¿‡ `name` æŸ¥æ‰¾ Skill

### 2.6 è·¯å¾„å˜é‡

Skill å†…å®¹ä¸­æ”¯æŒä»¥ä¸‹å˜é‡æ›¿æ¢ï¼š

| å˜é‡ | è¯´æ˜ |
|------|------|
| `${SKILL_ROOT}` | å½“å‰ Skill çš„æ ¹ç›®å½•è·¯å¾„ |
| `${SKILLS_DIR}` | Skills æ€»ç›®å½•è·¯å¾„ (~/.deepchat/skills/) |

**ç¤ºä¾‹**ï¼š
```markdown
è¯»å–æ£€æŸ¥æ¸…å•: ${SKILL_ROOT}/references/checklist.md
æ‰§è¡Œè„šæœ¬: ${SKILL_ROOT}/scripts/lint.sh
```

---

## 3. æ•°æ®æ¨¡å‹

### 3.1 SkillMetadataï¼ˆå…ƒæ•°æ®ï¼‰

å¯åŠ¨æ—¶ä» SKILL.md frontmatter æå–ï¼Œå§‹ç»ˆä¿ç•™åœ¨å†…å­˜ä¸­ã€‚

```typescript
interface SkillMetadata {
  name: string              // å”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆæ¥è‡ª frontmatterï¼Œä¸ç›®å½•åä¸€è‡´ï¼‰
  description: string       // æè¿°æ–‡æœ¬
  path: string              // SKILL.md å®Œæ•´è·¯å¾„
  skillRoot: string         // Skill æ ¹ç›®å½•è·¯å¾„
  allowedTools?: string[]   // é¢å¤–éœ€è¦çš„å·¥å…·ï¼ˆå¯é€‰ï¼‰
}
```

### 3.2 SkillStateï¼ˆä¼šè¯çŠ¶æ€ï¼‰

ä¸ Conversation å…³è”çš„æ¿€æ´»çŠ¶æ€ï¼Œéœ€è¦æŒä¹…åŒ–ã€‚

```typescript
interface SkillState {
  conversationId: string    // å…³è”çš„ä¼šè¯ ID
  activeSkills: Set<string> // å·²æ¿€æ´»çš„ Skill åç§°é›†åˆ
}
```

**æŒä¹…åŒ–æ–¹æ¡ˆ**ï¼š

å­˜å‚¨åœ¨ Conversation è®°å½•ä¸­ï¼ˆSQLite chat.dbï¼‰ï¼š

```typescript
// conversations è¡¨æ‰©å±•å­—æ®µ
interface Conversation {
  // ... ç°æœ‰å­—æ®µ
  activeSkills?: string[]   // JSON åºåˆ—åŒ–çš„æ¿€æ´» Skill åç§°æ•°ç»„
}
```

**ç”Ÿå‘½å‘¨æœŸ**ï¼š
- æ–°å»ºä¼šè¯ï¼š`activeSkills = []`
- æ¿€æ´»/åœç”¨ Skillï¼šæ›´æ–°å†…å­˜çŠ¶æ€ + æŒä¹…åŒ–åˆ°æ•°æ®åº“
- æ¢å¤ä¼šè¯ï¼šä»æ•°æ®åº“åŠ è½½ `activeSkills`ï¼Œè¿‡æ»¤æ‰å·²ä¸å­˜åœ¨çš„ Skill

### 3.3 SkillContentï¼ˆå®Œæ•´å†…å®¹ï¼‰

æ¿€æ´»ååŠ è½½ï¼Œæ³¨å…¥åˆ°ç³»ç»Ÿæç¤ºã€‚

```typescript
interface SkillContent {
  name: string
  content: string           // SKILL.md å®Œæ•´å†…å®¹ï¼ˆå« frontmatter åçš„æ­£æ–‡ï¼‰
}
```

---

## 4. å·¥å…·å®šä¹‰

### 4.1 skill_list

åˆ—å‡ºæ‰€æœ‰å¯ç”¨ Skills åŠå…¶æ¿€æ´»çŠ¶æ€ã€‚

```typescript
{
  name: "skill_list",
  description: "åˆ—å‡ºæ‰€æœ‰å¯ç”¨çš„ skills åŠå…¶å½“å‰æ¿€æ´»çŠ¶æ€",
  parameters: {
    type: "object",
    properties: {},
    required: []
  }
}

// è¿”å›ç¤ºä¾‹
{
  "skills": [
    { "name": "code-review", "description": "ä»£ç å®¡æŸ¥", "active": true },
    { "name": "refactor", "description": "ä»£ç é‡æ„", "active": false }
  ]
}
```

### 4.2 skill_control

æ¿€æ´»æˆ–åœç”¨æŒ‡å®š Skillã€‚

```typescript
{
  name: "skill_control",
  description: "æ¿€æ´»æˆ–åœç”¨ä¸€ä¸ª skillã€‚æ¿€æ´»åï¼Œè¯¥ skill çš„å®Œæ•´æŒ‡ä»¤å°†åœ¨ä¸‹ä¸€è½®å¯¹è¯ä¸­ç”Ÿæ•ˆ",
  parameters: {
    type: "object",
    properties: {
      action: {
        type: "string",
        enum: ["activate", "deactivate"],
        description: "æ“ä½œç±»å‹"
      },
      skill_name: {
        type: "string",
        description: "skill åç§°"
      }
    },
    required: ["action", "skill_name"]
  }
}

// è¿”å›ç¤ºä¾‹
{
  "success": true,
  "message": "Skill 'code-review' activated. Instructions will be loaded in next turn."
}
```

---

## 5. Agent Loop é›†æˆ

### 5.1 Context æ„å»ºæµç¨‹

```
æ¯è½® Loop å¼€å§‹å‰:

1. æ„å»ºåŸºç¡€ç³»ç»Ÿæç¤º
   â”‚
2. é™„åŠ  Skills Metadata åˆ—è¡¨ï¼ˆå« Skills æ ¹ç›®å½•è·¯å¾„ï¼‰
   â”‚  "## Available Skills
   â”‚   Skills directory: ~/.deepchat/skills/
   â”‚   You can activate these skills using skill_control tool:
   â”‚   - code-review: ä»£ç å®¡æŸ¥
   â”‚   - refactor: ä»£ç é‡æ„"
   â”‚
3. æ£€æŸ¥ SkillState.activeSkills
   â”‚
4. å¯¹æ¯ä¸ªæ¿€æ´»çš„ Skillï¼ŒåŠ è½½å®Œæ•´å†…å®¹
   â”‚  è¯»å– SKILL.md æ­£æ–‡éƒ¨åˆ†ï¼Œæ›¿æ¢ ${SKILL_ROOT} ç­‰å˜é‡
   â”‚
5. é™„åŠ åˆ°ç³»ç»Ÿæç¤º
   â”‚  "## Active Skills
   â”‚   [æ‰€æœ‰æ¿€æ´» Skill çš„å†…å®¹ä¾æ¬¡åˆ—å‡º]"
   â”‚
6. ç»§ç»­æ­£å¸¸çš„ Agent Loop
```

### 5.2 çŠ¶æ€ç”Ÿå‘½å‘¨æœŸ

```
æ–°å»ºä¼šè¯
    â”‚
    â–¼
SkillState = { conversationId, activeSkills: new Set() }
    â”‚
    â–¼
æŒä¹…åŒ–ç©ºçŠ¶æ€åˆ° Conversation.activeSkills
    â”‚
    â–¼
ç”¨æˆ·æ¶ˆæ¯ â†’ Agent Loop
    â”‚
    â–¼
æ¨¡å‹è°ƒç”¨ skill_control({ action: "activate", skill_name: "code-review" })
    â”‚
    â–¼
SkillState.activeSkills.add("code-review")
    â”‚
    â–¼
æŒä¹…åŒ–æ›´æ–°åˆ° Conversation.activeSkills
    â”‚
    â–¼
å½“å‰è½®ç»§ç»­æ‰§è¡Œï¼ˆSkill å†…å®¹å°šæœªåŠ è½½ï¼‰
    â”‚
    â–¼
ä¸‹ä¸€è½® Loop å¼€å§‹
    â”‚
    â–¼
æ£€æµ‹åˆ° "code-review" æ¿€æ´» â†’ åŠ è½½ SKILL.md å†…å®¹ â†’ æ³¨å…¥ç³»ç»Ÿæç¤º
    â”‚
    â–¼
æ¨¡å‹çœ‹åˆ°å®Œæ•´ Skill æŒ‡ä»¤ï¼ŒæŒ‰æŒ‡ä»¤è¡ŒåŠ¨


æ¢å¤ä¼šè¯ï¼ˆç”¨æˆ·é‡æ–°æ‰“å¼€å†å²ä¼šè¯ï¼‰
    â”‚
    â–¼
ä» Conversation.activeSkills åŠ è½½æŒä¹…åŒ–çŠ¶æ€
    â”‚
    â–¼
è¿‡æ»¤æ‰å·²ä¸å­˜åœ¨çš„ Skill åç§°
    â”‚
    â–¼
SkillState = { conversationId, activeSkills: è¿‡æ»¤åçš„é›†åˆ }
    â”‚
    â–¼
ç»§ç»­æ­£å¸¸çš„ Agent Loopï¼ˆå·²æ¿€æ´» Skill å†…å®¹ä¼šè¢«åŠ è½½ï¼‰
```

### 5.3 å·¥å…·åˆ—è¡¨æ„å»º

å½“ Skill å®šä¹‰äº† `allowedTools` æ—¶ï¼Œä¸ç”¨æˆ·å·²å¯ç”¨çš„å·¥å…·å–**å¹¶é›†**ï¼š

```
LLM è¯·æ±‚æ—¶å·¥å…·åˆ—è¡¨æ„å»º:
    â”‚
    â–¼
è·å–ç”¨æˆ·å·²å¯ç”¨çš„å·¥å…·åˆ—è¡¨ (userEnabledTools)
    â”‚
    â–¼
éå†æ‰€æœ‰æ¿€æ´»çš„ Skills
    â”‚
    â–¼
å¯¹æ¯ä¸ª Skillï¼Œè·å– allowedTools
    â”‚
    â–¼
æœ€ç»ˆå·¥å…·åˆ—è¡¨ = userEnabledTools âˆª skill1.allowedTools âˆª skill2.allowedTools âˆª ...
```

**è¯´æ˜**ï¼š
- `allowedTools` æ˜¯**æ‰©å±•**å·¥å…·åˆ—è¡¨ï¼Œè€Œéé™åˆ¶
- æç¤ºè¯ä¸­æåˆ°çš„å·¥å…·å’Œ tools å±æ€§ä¸­æš´éœ²çš„å·¥å…·æ˜¯ä¸¤ä¸ªæ¦‚å¿µ
- æç¤ºè¯å¯ä»¥å¼•å¯¼æ¨¡å‹ä½¿ç”¨æŸäº›å·¥å…·ï¼Œä½†å®é™…å¯ç”¨å·¥å…·ç”± tools åˆ—è¡¨å†³å®š

---

## 6. ç»„ä»¶è®¾è®¡

### 6.1 SkillPresenter

æ ¸å¿ƒåè°ƒå™¨ï¼Œè´Ÿè´£ Skill çš„å‘ç°ã€ç®¡ç†å’Œå†…å®¹åŠ è½½ã€‚

| æ–¹æ³• | èŒè´£ |
|------|------|
| `installBuiltinSkills()` | é¦–æ¬¡å¯åŠ¨æ—¶å®‰è£…å†…ç½® Skills åˆ°ç”¨æˆ·ç›®å½• |
| `installFromFolder(folderPath)` | ä»æœ¬åœ°æ–‡ä»¶å¤¹å®‰è£… Skill |
| `installFromZip(zipPath)` | ä»æœ¬åœ° zip æ–‡ä»¶å®‰è£… Skill |
| `installFromUrl(url)` | ä» URL ä¸‹è½½å¹¶å®‰è£… Skill |
| `uninstallSkill(name)` | å¸è½½æŒ‡å®š Skillï¼ˆåˆ é™¤æ–‡ä»¶å¤¹ï¼‰ |
| `discoverSkills()` | æ‰«æ skills ç›®å½•ï¼Œæå– Metadata |
| `getMetadataList()` | è¿”å›æ‰€æœ‰ Skill çš„ Metadata åˆ—è¡¨ |
| `getMetadataPrompt()` | ç”Ÿæˆ Metadata åˆ—è¡¨çš„æ–‡æœ¬ï¼ˆæ³¨å…¥ Contextï¼‰ |
| `loadSkillContent(name)` | è¯»å–æŒ‡å®š Skill çš„å®Œæ•´ SKILL.md å†…å®¹ï¼Œæ›¿æ¢è·¯å¾„å˜é‡ |
| `getSkillsDir()` | è·å– Skills æ ¹ç›®å½•è·¯å¾„ |
| `watchSkillFiles()` | ç›‘æ§ Skill æ–‡ä»¶å˜åŒ–ï¼Œè§¦å‘çƒ­åŠ è½½ |
| `getActiveSkillsAllowedTools(conversationId)` | è·å–ä¼šè¯ä¸­æ¿€æ´» Skills å£°æ˜çš„é¢å¤–å·¥å…·åˆ—è¡¨ |
| `getActiveSkills(conversationId)` | è·å–ä¼šè¯çš„æ¿€æ´» Skill åˆ—è¡¨ï¼ˆä»æŒä¹…åŒ–åŠ è½½ï¼‰ |
| `setActiveSkills(conversationId, skills)` | æ›´æ–°ä¼šè¯çš„æ¿€æ´» Skill åˆ—è¡¨ï¼ˆæŒä¹…åŒ–ï¼‰ |
| `validateSkillNames(names)` | è¿‡æ»¤æ‰å·²ä¸å­˜åœ¨çš„ Skill åç§° |

### 6.2 SkillTools

æš´éœ²ç»™æ¨¡å‹çš„å·¥å…·å®ç°ã€‚

| æ–¹æ³• | èŒè´£ |
|------|------|
| `handleSkillList(state)` | å¤„ç† skill_list å·¥å…·è°ƒç”¨ |
| `handleSkillControl(state, action, name)` | å¤„ç† skill_control å·¥å…·è°ƒç”¨ |

### 6.3 èŒè´£è¾¹ç•Œ

```
SkillPresenter          SkillTools              AgentLoop
     â”‚                       â”‚                       â”‚
     â”‚  æä¾›æ•°æ®             â”‚  æä¾›å·¥å…·             â”‚  ç®¡ç†çŠ¶æ€
     â”‚  - Metadata           â”‚  - skill_list        â”‚  - SkillState
     â”‚  - Content            â”‚  - skill_control     â”‚  - Context æ„å»º
     â”‚                       â”‚                       â”‚
```

---

## 7. ä¸ç°æœ‰ç³»ç»Ÿé›†æˆ

### 7.1 ä¸ ConfigPresenter

```
ConfigPresenter
     â”‚
     â””â”€â”€ getSkillSettings()
         â”œâ”€â”€ skillsPath: string           // Skills ç›®å½•è·¯å¾„ (~/.deepchat/skills/)
         â””â”€â”€ enableSkills: boolean        // å…¨å±€å¼€å…³
```

### 7.2 enableSkills å¼€å…³è¡Œä¸º

`enableSkills` æ˜¯ Skills ç³»ç»Ÿçš„å…¨å±€å¼€å…³ï¼Œæ§åˆ¶æ•´ä¸ªåŠŸèƒ½çš„å¯ç”¨/ç¦ç”¨ã€‚

**enableSkills = trueï¼ˆå¯ç”¨ï¼‰**ï¼š
- æ³¨å†Œ `skill_list` / `skill_control` å·¥å…·
- æ³¨å…¥ Skills Metadata åˆ—è¡¨åˆ° Context
- æ³¨å…¥æ¿€æ´» Skill çš„å®Œæ•´å†…å®¹åˆ° Context
- åˆå¹¶æ¿€æ´» Skills çš„ `allowedTools` åˆ°å·¥å…·åˆ—è¡¨
- æ­£å¸¸å¤„ç† Skill æ¿€æ´»/åœç”¨

**enableSkills = falseï¼ˆç¦ç”¨ï¼‰**ï¼š
- **ä¸æ³¨å†Œ** `skill_list` / `skill_control` å·¥å…·ï¼ˆæ¨¡å‹æ— æ³•çœ‹åˆ°å’Œè°ƒç”¨ï¼‰
- **ä¸æ³¨å…¥** Metadata åˆ—è¡¨åˆ° Context
- **ä¸æ³¨å…¥** æ¿€æ´» Skill å†…å®¹åˆ° Context
- **ä¸åˆå¹¶** `allowedTools` åˆ°å·¥å…·åˆ—è¡¨
- **ä¿ç•™**æŒä¹…åŒ–çš„ `activeSkills` çŠ¶æ€ï¼ˆè§†ä¸ºæŒ‚èµ·ï¼Œé‡æ–°å¯ç”¨åæ¢å¤ï¼‰

```
ç”¨æˆ·å…³é—­ enableSkills
    â”‚
    â–¼
Skills åŠŸèƒ½æŒ‚èµ·ï¼ˆéæ¸…é™¤ï¼‰
    â”‚
    â”œâ”€â”€ å·¥å…·ä¸å¯è§
    â”œâ”€â”€ æç¤ºè¯æ—  Skills ç›¸å…³å†…å®¹
    â”œâ”€â”€ å·¥å…·åˆ—è¡¨ä¸å« Skills çš„ allowedTools
    â”‚
    â””â”€â”€ Conversation.activeSkills ä¿æŒä¸å˜
              â”‚
              â–¼
        ç”¨æˆ·é‡æ–°å¼€å¯ enableSkills
              â”‚
              â–¼
        æ¢å¤ä¹‹å‰çš„æ¿€æ´»çŠ¶æ€
```

### 7.3 çƒ­åŠ è½½æœºåˆ¶

```
å¯åŠ¨æ—¶:
     â”‚
     â”œâ”€â”€ discoverSkills() â†’ æ‰«æå¹¶åŠ è½½æ‰€æœ‰ Metadata
     â”‚
     â””â”€â”€ watchSkillFiles() â†’ å¯åŠ¨æ–‡ä»¶ç›‘æ§
              â”‚
              â–¼
         ç›‘æ§ ~/.deepchat/skills/ ç›®å½•
              â”‚
              â–¼
         æ–‡ä»¶å˜åŒ–äº‹ä»¶ (add/change/unlink)
              â”‚
              â–¼
         é‡æ–°è§£æå—å½±å“çš„ SKILL.md
              â”‚
              â–¼
         æ›´æ–°å†…å­˜ä¸­çš„ Metadata
              â”‚
              â–¼
         å‘é€ SKILL_EVENTS.METADATA_UPDATED äº‹ä»¶
```

### 7.4 ä¸ McpPresenter

```
æ„å»º LLM è¯·æ±‚æ—¶çš„å·¥å…·åˆ—è¡¨:

SkillPresenter                    McpPresenter
     â”‚                                  â”‚
     â”‚  getActiveSkillsAllowedTools()   â”‚
     â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º   â”‚
     â”‚                                  â”‚
     â”‚  è¿”å› ["Read", "Bash(git:*)"]    â”‚
     â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
     â”‚                                  â”‚
     â”‚                    mergeTools(userEnabled, skillAllowed)
     â”‚                                  â”‚
     â”‚  è¿”å›åˆå¹¶åçš„å·¥å…·åˆ—è¡¨             â”‚
     â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
```

### 7.5 ä¸ AgentLoopHandler

```
AgentLoopHandler
     â”‚
     â”œâ”€â”€ æ£€æŸ¥ enableSkills é…ç½®
     â”‚   â”‚
     â”‚   â””â”€â”€ ä»…å½“ enableSkills = true æ—¶:
     â”‚       â”‚
     â”‚       â”œâ”€â”€ åˆå§‹åŒ– SkillState
     â”‚       â”‚
     â”‚       â”œâ”€â”€ æ³¨å†Œ skill_list / skill_control å·¥å…·
     â”‚       â”‚
     â”‚       â”œâ”€â”€ preparePromptContent() ä¸­:
     â”‚       â”‚   â”œâ”€â”€ é™„åŠ  Metadata åˆ—è¡¨
     â”‚       â”‚   â””â”€â”€ é™„åŠ æ¿€æ´» Skill çš„å®Œæ•´å†…å®¹
     â”‚       â”‚
     â”‚       â””â”€â”€ å¤„ç†å·¥å…·è°ƒç”¨æ—¶:
     â”‚           â””â”€â”€ è·¯ç”±åˆ° SkillTools
     â”‚
     â””â”€â”€ enableSkills = false æ—¶:
         â””â”€â”€ è·³è¿‡æ‰€æœ‰ Skills ç›¸å…³é€»è¾‘
```

### 7.6 ä¸ EventBus

```typescript
const SKILL_EVENTS = {
  DISCOVERED: 'skill:discovered',           // Skills å‘ç°å®Œæˆ
  METADATA_UPDATED: 'skill:metadata-updated', // Metadata çƒ­åŠ è½½æ›´æ–°
  INSTALLED: 'skill:installed',             // Skill å®‰è£…å®Œæˆ
  UNINSTALLED: 'skill:uninstalled',         // Skill å¸è½½å®Œæˆ
  ACTIVATED: 'skill:activated',             // Skill è¢«æ¿€æ´»
  DEACTIVATED: 'skill:deactivated'          // Skill è¢«åœç”¨
}
```

---

## 8. å¤š Skill æ¿€æ´»

å¤šä¸ª Skill åŒæ—¶æ¿€æ´»æ—¶ï¼Œå†…å®¹åœ¨åŒä¸€ä¸ªæ¿å—ä¸­ä¾æ¬¡åˆ—å‡ºï¼š

```
## Active Skills

[code-review çš„ SKILL.md å†…å®¹]

[refactor çš„ SKILL.md å†…å®¹]
```
